{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/mclovin/git/Clouds-Projects/react/covid_project/src/pages/Country.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, Fragment } from \"react\";\nimport { Redirect, withRouter } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { AppBar, Button, Toolbar, Typography } from \"@material-ui/core\";\nimport Summary from \"../components/Summary\";\nimport { useHistory } from \"react-router-dom\";\nimport PieChartCovid from \"../components/PieChartCovid\";\nimport BarChartCovid from \"../components/BarChartCovid\";\nimport LineChartCovid from \"../components/LineChartCovid\";\nimport CovidCountryTable from \"../components/CovidCountryTable\";\nimport firebase from \"firebase\";\nimport { app } from \"../base\";\nconst db = app.firestore();\n\nfunction Country({\n  location\n}) {\n  _s();\n\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [covidSummary, setCovidSummary] = useState({});\n  const [covidWorld, setCovidWorld] = useState([]);\n  const [lastSevenDays, setLastSevenDays] = useState({});\n  const [lastThirtyDays, setLastThirtyDays] = useState({});\n  const history = useHistory();\n  ;\n  var latestNewsRef = db.collection(\"news\").doc(location.state);\n\n  const updateDB = (data, date, doc) => {\n    db.collection(\"news\").doc(doc).set({\n      content: data,\n      date: date\n    }).then(() => {\n      console.log(\"DB updated\");\n    }).catch(error => {\n      console.log(\"error in updating DB\");\n    });\n  };\n\n  useEffect(async () => {\n    try {\n      latestNewsRef.get().then(async doc => {\n        const today = parseInt(new Date().getTime() / 86400000);\n\n        if (doc.exists) {\n          const date = doc.data().date;\n\n          if (today > date) {\n            const resThirty = await axios.get(`https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`);\n            setLastThirtyDays(resThirty.data.timeline);\n            updateDB(resThirty.data.timeline, today, location.state);\n          } else {\n            console.log(\"cached from DB\");\n            setLastThirtyDays(doc.data().content);\n          }\n        } else {\n          const resThirty = await axios.get(`https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`);\n          setLastThirtyDays(resThirty.data.timeline);\n          updateDB(resThirty.data.timeline, today, location.state);\n        }\n      });\n      setCovidSummary(location.summary); // const resWorld = await axios.get(\"https://api.covid19api.com/world\");\n      // setCovidWorld(resWorld.data);\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n  const auth = firebase.auth();\n  const [user, setuser] = useState(auth.currentUser);\n  const googleProvider = new firebase.auth.GoogleAuthProvider();\n\n  const signInWithGoogle = () => {\n    auth.signInWithPopup(googleProvider).then(res => {\n      var userRef = db.collection(\"users\").doc(res.user.email);\n      userRef.get().then(async doc => {\n        if (doc.exists) {\n          setuser(res.user);\n        } else {\n          auth.signOut(); // setuser(null);\n        }\n      });\n      console.log(res.user);\n    }).catch(error => {\n      console.log(error.message);\n    });\n  };\n\n  useEffect(() => {\n    setuser(auth.currentUser);\n  }, [auth.currentUser]); // console.log(lastThirtyDays);\n\n  if (!location.state) history.push(\"/\");else return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"Country\",\n    children: /*#__PURE__*/_jsxDEV(Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-lg-2\",\n          children: [!user && /*#__PURE__*/_jsxDEV(Button, {\n            color: \"inherit\",\n            onClick: signInWithGoogle,\n            children: \"Login\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 110,\n            columnNumber: 15\n          }, this), user && /*#__PURE__*/_jsxDEV(Button, {\n            color: \"inherit\",\n            onClick: () => {\n              auth.signOut().then(() => console.log('signed out'));\n              setuser(null);\n            },\n            children: \"Signout\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 11\n        }, this), covidSummary && Object.keys(covidSummary).includes(\"Country\") && /*#__PURE__*/_jsxDEV(Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Summary, {\n            data: covidSummary\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(PieChartCovid, {\n            data: covidSummary\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 13\n        }, this), lastThirtyDays && Object.keys(lastThirtyDays).includes(\"cases\") && /*#__PURE__*/_jsxDEV(Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(BarChartCovid, {\n            data: lastThirtyDays\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(LineChartCovid, {\n            data: lastThirtyDays\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 7\n  }, this);\n}\n\n_s(Country, \"DYRu6vub7FdKlHlpZAFzLph0P10=\", false, function () {\n  return [useHistory];\n});\n\n_c = Country;\nCountry.propTypes = {};\nexport default _c2 = withRouter(Country);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Country\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/home/mclovin/git/Clouds-Projects/react/covid_project/src/pages/Country.js"],"names":["React","useState","useEffect","Fragment","Redirect","withRouter","axios","AppBar","Button","Toolbar","Typography","Summary","useHistory","PieChartCovid","BarChartCovid","LineChartCovid","CovidCountryTable","firebase","app","db","firestore","Country","location","loggedIn","setLoggedIn","covidSummary","setCovidSummary","covidWorld","setCovidWorld","lastSevenDays","setLastSevenDays","lastThirtyDays","setLastThirtyDays","history","latestNewsRef","collection","doc","state","updateDB","data","date","set","content","then","console","log","catch","error","get","today","parseInt","Date","getTime","exists","resThirty","slug","timeline","summary","auth","user","setuser","currentUser","googleProvider","GoogleAuthProvider","signInWithGoogle","signInWithPopup","res","userRef","email","signOut","message","push","Object","keys","includes","propTypes"],"mappings":";;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,QAArC,QAAqD,OAArD;AACA,SAASC,QAAT,EAAmBC,UAAnB,QAAqC,kBAArC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAAQC,MAAR,EAAgBC,MAAhB,EAAwBC,OAAxB,EAAiCC,UAAjC,QAAkD,mBAAlD;AACA,OAAOC,OAAP,MAAoB,uBAApB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,aAAP,MAA0B,6BAA1B;AACA,OAAOC,aAAP,MAA0B,6BAA1B;AACA,OAAOC,cAAP,MAA2B,8BAA3B;AACA,OAAOC,iBAAP,MAA8B,iCAA9B;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,SAAQC,GAAR,QAAkB,SAAlB;AAEA,MAAMC,EAAE,GAAGD,GAAG,CAACE,SAAJ,EAAX;;AAGA,SAASC,OAAT,CAAiB;AAAEC,EAAAA;AAAF,CAAjB,EAA+B;AAAA;;AAC7B,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BvB,QAAQ,CAAC,KAAD,CAAxC;AACA,QAAM,CAACwB,YAAD,EAAeC,eAAf,IAAkCzB,QAAQ,CAAC,EAAD,CAAhD;AACA,QAAM,CAAC0B,UAAD,EAAaC,aAAb,IAA8B3B,QAAQ,CAAC,EAAD,CAA5C;AACA,QAAM,CAAC4B,aAAD,EAAgBC,gBAAhB,IAAoC7B,QAAQ,CAAC,EAAD,CAAlD;AACA,QAAM,CAAC8B,cAAD,EAAiBC,iBAAjB,IAAsC/B,QAAQ,CAAC,EAAD,CAApD;AACA,QAAMgC,OAAO,GAAGrB,UAAU,EAA1B;AACA;AACA,MAAIsB,aAAa,GAAGf,EAAE,CAACgB,UAAH,CAAc,MAAd,EAAsBC,GAAtB,CAA0Bd,QAAQ,CAACe,KAAnC,CAApB;;AAEA,QAAMC,QAAQ,GAAG,CAACC,IAAD,EAAOC,IAAP,EAAaJ,GAAb,KAAqB;AACpCjB,IAAAA,EAAE,CAACgB,UAAH,CAAc,MAAd,EACGC,GADH,CACOA,GADP,EAEGK,GAFH,CAEO;AACHC,MAAAA,OAAO,EAAEH,IADN;AAEHC,MAAAA,IAAI,EAAEA;AAFH,KAFP,EAMGG,IANH,CAMQ,MAAM;AACVC,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACD,KARH,EASGC,KATH,CASUC,KAAD,IAAW;AAChBH,MAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACD,KAXH;AAYD,GAbD;;AAeA3C,EAAAA,SAAS,CAAC,YAAY;AACpB,QAAI;AACFgC,MAAAA,aAAa,CAACc,GAAd,GAAoBL,IAApB,CAAyB,MAAOP,GAAP,IAAe;AACtC,cAAMa,KAAK,GAAGC,QAAQ,CAAC,IAAIC,IAAJ,GAAWC,OAAX,KAAuB,QAAxB,CAAtB;;AACA,YAAIhB,GAAG,CAACiB,MAAR,EAAgB;AACd,gBAAMb,IAAI,GAAGJ,GAAG,CAACG,IAAJ,GAAWC,IAAxB;;AACA,cAAIS,KAAK,GAAGT,IAAZ,EAAkB;AAChB,kBAAMc,SAAS,GAAG,MAAMhD,KAAK,CAAC0C,GAAN,CACrB,oDAAmD1B,QAAQ,CAACiC,IAAK,EAD5C,CAAxB;AAGAvB,YAAAA,iBAAiB,CAACsB,SAAS,CAACf,IAAV,CAAeiB,QAAhB,CAAjB;AACAlB,YAAAA,QAAQ,CAACgB,SAAS,CAACf,IAAV,CAAeiB,QAAhB,EAA0BP,KAA1B,EAAiC3B,QAAQ,CAACe,KAA1C,CAAR;AACD,WAND,MAMO;AACLO,YAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACAb,YAAAA,iBAAiB,CAACI,GAAG,CAACG,IAAJ,GAAWG,OAAZ,CAAjB;AACD;AACF,SAZD,MAYO;AACL,gBAAMY,SAAS,GAAG,MAAMhD,KAAK,CAAC0C,GAAN,CACrB,oDAAmD1B,QAAQ,CAACiC,IAAK,EAD5C,CAAxB;AAGAvB,UAAAA,iBAAiB,CAACsB,SAAS,CAACf,IAAV,CAAeiB,QAAhB,CAAjB;AACAlB,UAAAA,QAAQ,CAACgB,SAAS,CAACf,IAAV,CAAeiB,QAAhB,EAA0BP,KAA1B,EAAiC3B,QAAQ,CAACe,KAA1C,CAAR;AACD;AACF,OArBD;AAuBAX,MAAAA,eAAe,CAACJ,QAAQ,CAACmC,OAAV,CAAf,CAxBE,CA0BF;AACA;AACD,KA5BD,CA4BE,OAAOV,KAAP,EAAc;AACdH,MAAAA,OAAO,CAACC,GAAR,CAAYE,KAAZ;AACD;AACF,GAhCQ,EAgCN,EAhCM,CAAT;AAiCA,QAAMW,IAAI,GAAGzC,QAAQ,CAACyC,IAAT,EAAb;AACA,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkB3D,QAAQ,CAACyD,IAAI,CAACG,WAAN,CAAhC;AACA,QAAMC,cAAc,GAAG,IAAI7C,QAAQ,CAACyC,IAAT,CAAcK,kBAAlB,EAAvB;;AACA,QAAMC,gBAAgB,GAAG,MAAM;AAC7BN,IAAAA,IAAI,CACDO,eADH,CACmBH,cADnB,EAEGnB,IAFH,CAESuB,GAAD,IAAS;AACb,UAAIC,OAAO,GAAGhD,EAAE,CAACgB,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2B8B,GAAG,CAACP,IAAJ,CAASS,KAApC,CAAd;AACAD,MAAAA,OAAO,CAACnB,GAAR,GAAcL,IAAd,CAAmB,MAAOP,GAAP,IAAe;AAChC,YAAIA,GAAG,CAACiB,MAAR,EAAgB;AACdO,UAAAA,OAAO,CAACM,GAAG,CAACP,IAAL,CAAP;AACD,SAFD,MAEO;AACLD,UAAAA,IAAI,CAACW,OAAL,GADK,CAEL;AACD;AACF,OAPD;AAQAzB,MAAAA,OAAO,CAACC,GAAR,CAAYqB,GAAG,CAACP,IAAhB;AACD,KAbH,EAcGb,KAdH,CAcUC,KAAD,IAAW;AAChBH,MAAAA,OAAO,CAACC,GAAR,CAAYE,KAAK,CAACuB,OAAlB;AACD,KAhBH;AAiBD,GAlBD;;AAmBApE,EAAAA,SAAS,CAAC,MAAM;AACd0D,IAAAA,OAAO,CAACF,IAAI,CAACG,WAAN,CAAP;AACD,GAFQ,EAEN,CAACH,IAAI,CAACG,WAAN,CAFM,CAAT,CAhF6B,CAmF7B;;AACA,MAAI,CAACvC,QAAQ,CAACe,KAAd,EAAqBJ,OAAO,CAACsC,IAAR,CAAa,GAAb,EAArB,KAEE,oBACE;AAAK,IAAA,SAAS,EAAC,SAAf;AAAA,2BACA,QAAC,QAAD;AAAA,6BACE;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA,gCACE;AAAK,UAAA,SAAS,EAAC,UAAf;AAAA,qBACG,CAACZ,IAAD,iBACC,QAAC,MAAD;AAAQ,YAAA,KAAK,EAAC,SAAd;AAAwB,YAAA,OAAO,EAAEK,gBAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFJ,EAMGL,IAAI,iBACH,QAAC,MAAD;AACE,YAAA,KAAK,EAAC,SADR;AAEE,YAAA,OAAO,EAAE,MAAM;AACbD,cAAAA,IAAI,CAACW,OAAL,GAAe1B,IAAf,CAAoB,MAAIC,OAAO,CAACC,GAAR,CAAY,YAAZ,CAAxB;AACAe,cAAAA,OAAO,CAAC,IAAD,CAAP;AACD,aALH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAPJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,EAmBGnC,YAAY,IAAI+C,MAAM,CAACC,IAAP,CAAYhD,YAAZ,EAA0BiD,QAA1B,CAAmC,SAAnC,CAAhB,iBACC,QAAC,QAAD;AAAA,kCACE,QAAC,OAAD;AAAS,YAAA,IAAI,EAAEjD;AAAf;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE,QAAC,aAAD;AAAe,YAAA,IAAI,EAAEA;AAArB;AAAA;AAAA;AAAA;AAAA,kBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,gBApBJ,EAyBGM,cAAc,IAAIyC,MAAM,CAACC,IAAP,CAAY1C,cAAZ,EAA4B2C,QAA5B,CAAqC,OAArC,CAAlB,iBACC,QAAC,QAAD;AAAA,kCACE,QAAC,aAAD;AAAe,YAAA,IAAI,EAAE3C;AAArB;AAAA;AAAA;AAAA;AAAA,kBADF,eAEE,QAAC,cAAD;AAAgB,YAAA,IAAI,EAAEA;AAAtB;AAAA;AAAA;AAAA;AAAA,kBAFF;AAAA;AAAA;AAAA;AAAA;AAAA,gBA1BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA,UADF;AAsCH;;GA5HQV,O;UAMST,U;;;KANTS,O;AA8HTA,OAAO,CAACsD,SAAR,GAAoB,EAApB;AAEA,qBAAetE,UAAU,CAACgB,OAAD,CAAzB","sourcesContent":["import React, { useState, useEffect, Fragment } from \"react\";\nimport { Redirect, withRouter } from \"react-router-dom\";\nimport axios from \"axios\";\nimport {AppBar, Button, Toolbar, Typography} from \"@material-ui/core\";\nimport Summary from \"../components/Summary\";\nimport { useHistory } from \"react-router-dom\";\nimport PieChartCovid from \"../components/PieChartCovid\";\nimport BarChartCovid from \"../components/BarChartCovid\";\nimport LineChartCovid from \"../components/LineChartCovid\";\nimport CovidCountryTable from \"../components/CovidCountryTable\";\nimport firebase from \"firebase\";\n\nimport {app} from \"../base\"\n\nconst db = app.firestore()\n\n\nfunction Country({ location }) {\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [covidSummary, setCovidSummary] = useState({});\n  const [covidWorld, setCovidWorld] = useState([]);\n  const [lastSevenDays, setLastSevenDays] = useState({});\n  const [lastThirtyDays, setLastThirtyDays] = useState({});\n  const history = useHistory();\n  ;\n  var latestNewsRef = db.collection(\"news\").doc(location.state);\n\n  const updateDB = (data, date, doc) => {\n    db.collection(\"news\")\n      .doc(doc)\n      .set({\n        content: data,\n        date: date,\n      })\n      .then(() => {\n        console.log(\"DB updated\");\n      })\n      .catch((error) => {\n        console.log(\"error in updating DB\");\n      });\n  };\n\n  useEffect(async () => {\n    try {\n      latestNewsRef.get().then(async (doc) => {\n        const today = parseInt(new Date().getTime() / 86400000);\n        if (doc.exists) {\n          const date = doc.data().date;\n          if (today > date) {\n            const resThirty = await axios.get(\n              `https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`\n            );\n            setLastThirtyDays(resThirty.data.timeline);\n            updateDB(resThirty.data.timeline, today, location.state);\n          } else {\n            console.log(\"cached from DB\");\n            setLastThirtyDays(doc.data().content);\n          }\n        } else {\n          const resThirty = await axios.get(\n            `https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`\n          );\n          setLastThirtyDays(resThirty.data.timeline);\n          updateDB(resThirty.data.timeline, today, location.state);\n        }\n      });\n\n      setCovidSummary(location.summary);\n\n      // const resWorld = await axios.get(\"https://api.covid19api.com/world\");\n      // setCovidWorld(resWorld.data);\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n  const auth = firebase.auth();\n  const [user, setuser] = useState(auth.currentUser);\n  const googleProvider = new firebase.auth.GoogleAuthProvider();\n  const signInWithGoogle = () => {\n    auth\n      .signInWithPopup(googleProvider)\n      .then((res) => {\n        var userRef = db.collection(\"users\").doc(res.user.email);\n        userRef.get().then(async (doc) => {\n          if (doc.exists) {\n            setuser(res.user);\n          } else {\n            auth.signOut();\n            // setuser(null);\n          }\n        });\n        console.log(res.user);\n      })\n      .catch((error) => {\n        console.log(error.message);\n      });\n  };\n  useEffect(() => {\n    setuser(auth.currentUser)\n  }, [auth.currentUser])\n  // console.log(lastThirtyDays);\n  if (!location.state) history.push(\"/\");\n  else\n    return (\n      <div className=\"Country\">\n      <Fragment>\n        <div className=\"container\">\n          <div className=\"col-lg-2\">\n            {!user && (\n              <Button color=\"inherit\" onClick={signInWithGoogle}>\n                Login\n              </Button>\n            )}\n            {user && (\n              <Button\n                color=\"inherit\"\n                onClick={() => {\n                  auth.signOut().then(()=>console.log('signed out'));\n                  setuser(null);\n                }}\n              >\n                Signout\n              </Button>\n            )}\n          </div>\n          {covidSummary && Object.keys(covidSummary).includes(\"Country\") && (\n            <Fragment>\n              <Summary data={covidSummary} />\n              <PieChartCovid data={covidSummary} />\n            </Fragment>\n          )}\n          {lastThirtyDays && Object.keys(lastThirtyDays).includes(\"cases\") && (\n            <Fragment>\n              <BarChartCovid data={lastThirtyDays} />\n              <LineChartCovid data={lastThirtyDays} />\n            </Fragment>\n          )}\n        </div>\n      </Fragment>\n    </div>\n    );\n}\n\nCountry.propTypes = {};\n\nexport default withRouter(Country);\n"]},"metadata":{},"sourceType":"module"}