{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/mclovin/git/Clouds-Projects/react/covid_project/src/pages/Country.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, Fragment } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Fab from \"@material-ui/core/Fab\";\nimport { Redirect, withRouter } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { AppBar, Button, Table, TableBody, TableCell, TableContainer, TableRow, Toolbar, Typography } from \"@material-ui/core\";\nimport Summary from \"../components/Summary\";\nimport { useHistory } from \"react-router-dom\";\nimport PieChartCovid from \"../components/PieChartCovid\";\nimport BarChartCovid from \"../components/BarChartCovid\";\nimport LineChartCovid from \"../components/LineChartCovid\";\nimport CovidCountryTable from \"../components/CovidCountryTable\";\nimport firebase from \"firebase\";\n\nfunction Country({\n  location\n}) {\n  _s();\n\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [covidSummary, setCovidSummary] = useState({});\n  const [covidWorld, setCovidWorld] = useState([]);\n  const [lastSevenDays, setLastSevenDays] = useState({});\n  const [lastThirtyDays, setLastThirtyDays] = useState({});\n  const history = useHistory();\n  const db = firebase.firestore();\n  var latestNewsRef = db.collection(\"news\").doc(location.state);\n\n  const updateDB = (data, date, doc) => {\n    db.collection(\"news\").doc(doc).set({\n      content: data,\n      date: date\n    }).then(() => {\n      console.log(\"DB updated\");\n    }).catch(error => {\n      console.log(\"error in updating DB\");\n    });\n  };\n\n  useEffect(async () => {\n    try {\n      latestNewsRef.get().then(async doc => {\n        const today = parseInt(new Date().getTime() / 86400000);\n\n        if (doc.exists) {\n          const date = doc.data().date;\n\n          if (today > date) {\n            const resThirty = await axios.get(`https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`);\n            setLastThirtyDays(resThirty.data.timeline);\n            updateDB(resThirty.data.timeline, today, location.state);\n          } else {\n            console.log(\"cached from DB\");\n            setLastThirtyDays(doc.data().content);\n          }\n        } else {\n          const resThirty = await axios.get(`https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`);\n          setLastThirtyDays(resThirty.data.timeline);\n          updateDB(resThirty.data.timeline, today, location.state);\n        }\n      });\n      setCovidSummary(location.summary); // const resWorld = await axios.get(\"https://api.covid19api.com/world\");\n      // setCovidWorld(resWorld.data);\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n  const auth = firebase.auth();\n  const [user, setuser] = useState(auth.currentUser);\n  const googleProvider = new firebase.auth.GoogleAuthProvider();\n\n  const signInWithGoogle = () => {\n    auth.signInWithPopup(googleProvider).then(res => {\n      var userRef = db.collection(\"users\").doc(res.user.email);\n      userRef.get().then(async doc => {\n        if (doc.exists) {\n          setuser(res.user);\n        } else {\n          auth.signOut(); // setuser(null);\n        }\n      });\n      console.log(res.user);\n    }).catch(error => {\n      console.log(error.message);\n    });\n  };\n\n  useEffect(() => {\n    setuser(auth.currentUser);\n  }, [auth.currentUser]); // console.log(lastThirtyDays);\n\n  if (!location.state) history.push(\"/\");else return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(AppBar, {\n      position: \"static\",\n      children: /*#__PURE__*/_jsxDEV(Toolbar, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h6\",\n          style: {\n            flexGrow: 1\n          },\n          children: [\"Welcome \", user ? user.displayName : \"To Our Website\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 11\n        }, this), !user && /*#__PURE__*/_jsxDEV(Button, {\n          color: \"inherit\",\n          onClick: signInWithGoogle,\n          children: \"Login\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 13\n        }, this), user && /*#__PURE__*/_jsxDEV(Button, {\n          color: \"inherit\",\n          onClick: () => {\n            auth.signOut().then(() => console.log('signed out'));\n            setuser(null);\n          },\n          children: \"Signout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }, this), covidSummary && Object.keys(covidSummary).includes(\"Country\") && /*#__PURE__*/_jsxDEV(Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Summary, {\n        data: covidSummary\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(PieChartCovid, {\n        data: covidSummary\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 11\n    }, this), lastThirtyDays && Object.keys(lastThirtyDays).includes(\"cases\") && /*#__PURE__*/_jsxDEV(Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(BarChartCovid, {\n        data: lastThirtyDays\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(LineChartCovid, {\n        data: lastThirtyDays\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 7\n  }, this);\n}\n\n_s(Country, \"DYRu6vub7FdKlHlpZAFzLph0P10=\", false, function () {\n  return [useHistory];\n});\n\n_c = Country;\nCountry.propTypes = {};\nexport default Country;\n\nvar _c;\n\n$RefreshReg$(_c, \"Country\");","map":{"version":3,"sources":["/home/mclovin/git/Clouds-Projects/react/covid_project/src/pages/Country.js"],"names":["React","useState","useEffect","Fragment","PropTypes","Fab","Redirect","withRouter","axios","AppBar","Button","Table","TableBody","TableCell","TableContainer","TableRow","Toolbar","Typography","Summary","useHistory","PieChartCovid","BarChartCovid","LineChartCovid","CovidCountryTable","firebase","Country","location","loggedIn","setLoggedIn","covidSummary","setCovidSummary","covidWorld","setCovidWorld","lastSevenDays","setLastSevenDays","lastThirtyDays","setLastThirtyDays","history","db","firestore","latestNewsRef","collection","doc","state","updateDB","data","date","set","content","then","console","log","catch","error","get","today","parseInt","Date","getTime","exists","resThirty","slug","timeline","summary","auth","user","setuser","currentUser","googleProvider","GoogleAuthProvider","signInWithGoogle","signInWithPopup","res","userRef","email","signOut","message","push","flexGrow","displayName","Object","keys","includes","propTypes"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, Fragment } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Fab from \"@material-ui/core/Fab\";\nimport { Redirect, withRouter } from \"react-router-dom\";\nimport axios from \"axios\";\nimport {\n  AppBar,\n  Button,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableRow,\n  Toolbar,\n  Typography,\n} from \"@material-ui/core\";\nimport Summary from \"../components/Summary\";\nimport { useHistory } from \"react-router-dom\";\nimport PieChartCovid from \"../components/PieChartCovid\";\nimport BarChartCovid from \"../components/BarChartCovid\";\nimport LineChartCovid from \"../components/LineChartCovid\";\nimport CovidCountryTable from \"../components/CovidCountryTable\";\nimport firebase from \"firebase\";\n\nfunction Country({ location }) {\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [covidSummary, setCovidSummary] = useState({});\n  const [covidWorld, setCovidWorld] = useState([]);\n  const [lastSevenDays, setLastSevenDays] = useState({});\n  const [lastThirtyDays, setLastThirtyDays] = useState({});\n  const history = useHistory();\n  const db = firebase.firestore();\n  var latestNewsRef = db.collection(\"news\").doc(location.state);\n\n  const updateDB = (data, date, doc) => {\n    db.collection(\"news\")\n      .doc(doc)\n      .set({\n        content: data,\n        date: date,\n      })\n      .then(() => {\n        console.log(\"DB updated\");\n      })\n      .catch((error) => {\n        console.log(\"error in updating DB\");\n      });\n  };\n\n  useEffect(async () => {\n    try {\n      latestNewsRef.get().then(async (doc) => {\n        const today = parseInt(new Date().getTime() / 86400000);\n        if (doc.exists) {\n          const date = doc.data().date;\n          if (today > date) {\n            const resThirty = await axios.get(\n              `https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`\n            );\n            setLastThirtyDays(resThirty.data.timeline);\n            updateDB(resThirty.data.timeline, today, location.state);\n          } else {\n            console.log(\"cached from DB\");\n            setLastThirtyDays(doc.data().content);\n          }\n        } else {\n          const resThirty = await axios.get(\n            `https://corona.lmao.ninja/v3/covid-19/historical/${location.slug}`\n          );\n          setLastThirtyDays(resThirty.data.timeline);\n          updateDB(resThirty.data.timeline, today, location.state);\n        }\n      });\n\n      setCovidSummary(location.summary);\n\n      // const resWorld = await axios.get(\"https://api.covid19api.com/world\");\n      // setCovidWorld(resWorld.data);\n    } catch (error) {\n      console.log(error);\n    }\n  }, []);\n  const auth = firebase.auth();\n  const [user, setuser] = useState(auth.currentUser);\n  const googleProvider = new firebase.auth.GoogleAuthProvider();\n  const signInWithGoogle = () => {\n    auth\n      .signInWithPopup(googleProvider)\n      .then((res) => {\n        var userRef = db.collection(\"users\").doc(res.user.email);\n        userRef.get().then(async (doc) => {\n          if (doc.exists) {\n            setuser(res.user);\n          } else {\n            auth.signOut();\n            // setuser(null);\n          }\n        });\n        console.log(res.user);\n      })\n      .catch((error) => {\n        console.log(error.message);\n      });\n  };\n  useEffect(() => {\n    setuser(auth.currentUser)\n  }, [auth.currentUser])\n  // console.log(lastThirtyDays);\n  if (!location.state) history.push(\"/\");\n  else\n    return (\n      <Fragment>\n        <AppBar position=\"static\">\n        <Toolbar>\n          <Typography variant=\"h6\" style={{ flexGrow: 1 }}>\n            Welcome {user ? user.displayName : \"To Our Website\"}\n          </Typography>\n          {!user && (\n            <Button color=\"inherit\" onClick={signInWithGoogle}>\n              Login\n            </Button>\n          )}\n          {user && (\n            <Button\n              color=\"inherit\"\n              onClick={() => {\n                auth.signOut().then(()=>console.log('signed out'));\n                setuser(null);\n              }}\n            >\n              Signout\n            </Button>\n          )}\n        </Toolbar>\n      </AppBar>\n        {covidSummary && Object.keys(covidSummary).includes(\"Country\") && (\n          <Fragment>\n            <Summary data={covidSummary} />\n            <PieChartCovid data={covidSummary} />\n          </Fragment>\n        )}\n        {lastThirtyDays && Object.keys(lastThirtyDays).includes(\"cases\") && (\n          <Fragment>\n            <BarChartCovid data={lastThirtyDays} />\n            <LineChartCovid data={lastThirtyDays} />\n          </Fragment>\n        )}\n        {/*\n      {Object.keys(covidSummary).includes(\"Global\") && (\n        <Fragment>\n          <CovidCountryTable data={covidSummary[\"Countries\"]} />\n        </Fragment>\n      )}*/}\n      </Fragment>\n    );\n}\n\nCountry.propTypes = {};\n\nexport default Country;\n"]},"metadata":{},"sourceType":"module"}